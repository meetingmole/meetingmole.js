/*
 * MeetingMole API JavaScript Client v1.0.2
 * Copyright 2015-2016 MeetingMole GmbH. All Rights Reserved.
 * More info, documentation and source: https://github.com/meetingmole/meetingmole.js
*/
"use strict";var MeetingMole;!function(a){var b;!function(b){function c(){h=$("#btnPing"),i=$("#btnLogin"),j=$("#btnLogout"),g=$("#divResponseDisplay"),k=$("#txServerURL"),l=$("#btnClearLog"),k.off("change").on("change",function(){m&&(m.Dispose(),m=null);var b=k.val().trim();m=b?new a.JSClient(b):null}),k.val("http://localhost:56936").trigger("change"),l.off("click").on("click",function(){e()}),h.off("click").on("click",function(){return m?(f("Pinging "+m.ServerURL()+"..."),void m.Ping(function(a){f("Ping success!",n.Success),f("Response:"+d(a),n.Indent)},function(a){f("Ping failed."),f("Error: "+d(a),n.Error)})):void f("Not connected to server. Please define server URL to connect to.",n.Error)}),i.off("click").on("click",function(){return m?m.IsConnected()?void f("Already logged in.",n.Normal):(f("Logging in to "+m.ServerURL()+"..."),void m.Login($("#txLogin").val(),$("#txPassword").val(),function(){f("Login success!",n.Success)},function(a){f("Login failed."),f("Error: "+d(a),n.Error)})):void f("Not connected to server. Please define server URL to connect to.",n.Error)}),j.off("click").on("click",function(){return m?m.IsConnected()?(f("Logging out from "+m.ServerURL()+"..."),void m.Logout(function(){f("You have been logged out.",n.Success)},function(a){f("Logout failed."),f("Error: "+d(a),n.Error)})):void f("Not logged in. Please log in first.",n.Error):void f("Not connected to server. Please define server URL to connect to.",n.Error)})}function d(a){return"string"!=typeof a&&(a=JSON.stringify(a,void 0,2)),a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"<pre>"+a.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(a){var b="number";return/^"/.test(a)?b=/:$/.test(a)?"key":"string":/true|false/.test(a)?b="boolean":/null/.test(a)&&(b="null"),'<span class="'+b+'">'+a+"</span>"})+"</pre>"}function e(){g.empty()}function f(a,b){if(void 0===b&&(b=n.Normal),a){var c=n[b].toLowerCase();g.append("<div class='log-"+c+"'>"+a+"</div>")}}var g=null,h=null,i=null,j=null,k=null,l=null,m=null;b.Init=c;var n;!function(a){a[a.Normal=0]="Normal",a[a.Error=1]="Error",a[a.Success=2]="Success",a[a.Indent=3]="Indent"}(n||(n={}))}(b=a.JSClientTest||(a.JSClientTest={}))}(MeetingMole||(MeetingMole={}));var MeetingMole;!function(a){var b;!function(a){a.BaseURL="/publicapi/v1/",a.APIURLs={SimpleLogin:"access/simplelogin",About:"access/about",CheckToken:"access/simplelogin",Logout:"access/logout"}}(b=a.Constants||(a.Constants={}))}(MeetingMole||(MeetingMole={}));var MeetingMole;!function(a){var b=function(){function b(b){if(this.oAuthentication=null,this.dtTokenExpires=null,this.sServerURL=null,this.bIsConnected=!1,!b)throw"Parameter sServerURL must be defined.";if(b=b.trim(),0!==b.indexOf("http://")&&0!==b.indexOf("https://"))throw"Parameter sServerURL must start with authority (http:// or https://).";"/"===b[b.length-1]&&(b=b.substring(0,b.length-1)),this.sServerURL=b+a.Constants.BaseURL}return b.prototype.Version=function(){return"1.0.2"},b.prototype.ServerURL=function(){return this.sServerURL},b.prototype.Username=function(){return this.bIsConnected&&this.oAuthentication?this.oAuthentication.Username:null},b.prototype.IsConnected=function(){return this.bIsConnected},b.prototype.Dispose=function(){this.IsConnected()&&this.Logout(function(){},function(){}),this.sServerURL=null},b.prototype.Ping=function(b,c){var d=this;$.ajax({url:this.sServerURL+a.Constants.APIURLs.About,method:"get",timeout:3e4,cache:!1,success:function(a,e,f){var g=d.handleError(a);return g?void c(g):void b(a)},error:function(a,b,e){var f=d.handleProtocolError(a);c(f)}})},b.prototype.CheckToken=function(b,c){var d=this;this.IsConnected()&&$.ajax({url:this.sServerURL+a.Constants.APIURLs.CheckToken,data:{Authentication:this.oAuthentication},method:"post",timeout:3e4,cache:!1,success:function(a){var e=d.handleError(a);return e?void c(e):(d.dtTokenExpires=a.TokenExpires,void b())},error:function(a){var b=d.handleProtocolError(a);c(b)}})},b.prototype.Logout=function(b,c){var d=this;this.IsConnected()&&$.ajax({url:this.sServerURL+a.Constants.APIURLs.Logout,data:{Authentication:this.oAuthentication,InvalidateAllTokens:!1},method:"post",timeout:3e4,cache:!1,success:function(a){var e=d.handleError(a);return e?void c(e):(d.resetAuthentication(),void b(a))},error:function(a){var b=d.handleProtocolError(a);c(b)}})},b.prototype.Login=function(b,c,d,e){var f=this;this.IsConnected()||(this.resetAuthentication(),this.oAuthentication={Username:b,ClientSecret:this.generateClientSecret(),AccessToken:null},$.ajax({url:this.sServerURL+a.Constants.APIURLs.SimpleLogin,data:{Username:this.oAuthentication.Username,Password:c,ClientSecret:this.oAuthentication.ClientSecret},method:"post",timeout:6e4,cache:!1,success:function(a,b,c){console.log(c);var g=f.handleError(a);return g?(f.resetAuthentication(),void e(g)):(f.bIsConnected=!0,f.oAuthentication.AccessToken=a.AccessToken,f.dtTokenExpires=a.TokenExpires,void d())},error:function(a,b,c){f.resetAuthentication(),console.log(b),console.log(c);var d=f.handleProtocolError(a);e(d)}}))},b.prototype.LoginWithToken=function(b,c,d,e,f){var g=this;this.IsConnected()||(this.resetAuthentication(),this.oAuthentication={Username:b,ClientSecret:d,AccessToken:c},$.ajax({url:this.sServerURL+a.Constants.APIURLs.CheckToken,data:this.oAuthentication,method:"post",timeout:6e4,cache:!1,success:function(a,b,c){console.log(c);var d=g.handleError(a);return d?(g.resetAuthentication(),void f(d)):(g.bIsConnected=!0,g.dtTokenExpires=a.TokenExpires,void e())},error:function(a,b,c){g.resetAuthentication(),console.log(b),console.log(c);var d=g.handleProtocolError(a);f(d)}}))},b.prototype.resetAuthentication=function(){this.bIsConnected=!1,this.oAuthentication=null,this.dtTokenExpires=null},b.prototype.handleError=function(a){return a?a.error?a.error:null:{HttpErrorCode:400,Error:"No response received from server",ErrorDetails:""}},b.prototype.handleProtocolError=function(a){if(!a)return{HttpErrorCode:-1,Error:"Unknown error",ErrorDetails:""};console.log(a);var b=-1,c="Unknown error";return a.status>0&&(b=a.status),a.statusText&&(c=a.statusText),{HttpErrorCode:b,Error:c,ErrorDetails:""}},b.prototype.generateClientSecret=function(){return this.generateRandomString(64)},b.prototype.generateRandomString=function(a){for(var b="",c='<>|^*~!#?-_.,:;Â¤%&/()={[]}\\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',d=0;a>d;d++)b+=c.charAt(Math.floor(Math.random()*b.length));return b},b}();a.JSClient=b}(MeetingMole||(MeetingMole={}));
//# sourceMappingURL=meetingmole.js.map