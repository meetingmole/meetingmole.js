/*
 * MeetingMole API JavaScript Client v1.0.2
 * Copyright 2015-2016 MeetingMole GmbH. All Rights Reserved.
 * More info, documentation and source: https://github.com/meetingmole/meetingmole.js
*/
"use strict";var MeetingMole;!function(a){var b;!function(a){var b=function(){function a(a){this.oClient=null,this.oClient=a}return a}();a.ItemController=b}(b=a.SDK||(a.SDK={}))}(MeetingMole||(MeetingMole={}));var MeetingMole;!function(a){var b;!function(a){var b=function(){function b(b){if(this.oAuthentication=null,this.dtTokenExpires=null,this.Items=null,this.Teams=null,this.Widgets=null,this.sServerURL=null,this.bIsConnected=!1,!jQuery)throw"meetingmole.js requires jQuery.";if(!b)throw"meetingmole.js: Parameter sServerURL must be defined.";if(b=b.trim(),0!==b.indexOf("http://")&&0!==b.indexOf("https://"))throw"meetingmole.js: Parameter sServerURL must start with authority (http:// or https://).";"/"===b[b.length-1]&&(b=b.substring(0,b.length-1)),this.sServerURL=b+a.Constants.BaseURL,this.Items=new a.ItemController(this),this.Teams=new a.TeamController(this),this.Widgets=new a.WidgetController(this)}return b.prototype.Authentication=function(){return this.oAuthentication},b.prototype.ClientVersion=function(){return"1.0.2"},b.prototype.ServerURL=function(){return this.sServerURL},b.prototype.Username=function(){return this.bIsConnected&&this.oAuthentication?this.oAuthentication.Username:null},b.prototype.IsConnected=function(){return this.bIsConnected},b.prototype.Dispose=function(){var a=this;this.IsConnected()&&this.Logout(function(){},function(){a.resetAuthentication()}),this.sServerURL=null},b.prototype.Ping=function(a,b){var c=new Date;this.GetVersionInfo(function(){var b=new Date,d=b.valueOf()-c.valueOf();a(d)},b)},b.prototype.GetVersionInfo=function(b,c){var d=this;$.ajax({url:this.sServerURL+a.Constants.AccessAPIURLs.About,method:"get",timeout:3e4,cache:!1,success:function(a,e,f){var g=d.HandleError(a,e,f);if(g)return void c(g);var h={ClientVersion:d.ClientVersion(),APIVersion:a.Version,WebAppVersion:a.WebAppVersion,CoreVersion:a.CoreVersion};b(h)},error:function(a,b,e){d.HandleProtocolError(e,b,a,c)}})},b.prototype.CheckToken=function(b,c){var d=this;this.IsConnected()&&$.ajax({url:this.sServerURL+a.Constants.AccessAPIURLs.CheckToken,data:{Authentication:this.oAuthentication},method:"post",timeout:3e4,cache:!1,success:function(a,e,f){var g=d.HandleError(a,e,f);return g?void c(g):(d.dtTokenExpires=a.TokenExpires,void b())},error:function(a,b,e){d.HandleProtocolError(e,b,a,c)}})},b.prototype.Logout=function(b,c){var d=this;this.IsConnected()&&$.ajax({url:this.sServerURL+a.Constants.AccessAPIURLs.Logout,data:{Authentication:this.oAuthentication,InvalidateAllTokens:!1},method:"post",timeout:3e4,cache:!1,success:function(a,e,f){var g=d.HandleError(a,e,f);return g?void c(g):(d.resetAuthentication(),void b(a))},error:function(a,b,e){d.HandleProtocolError(e,b,a,c)}})},b.prototype.Login=function(b,c,d,e){var f=this;this.IsConnected()||(this.resetAuthentication(),this.oAuthentication={Username:b,ClientSecret:this.generateClientSecret(),AccessToken:null},$.ajax({url:this.sServerURL+a.Constants.AccessAPIURLs.SimpleLogin,data:{Username:this.oAuthentication.Username,Password:c,ClientSecret:this.oAuthentication.ClientSecret},method:"post",timeout:6e4,cache:!1,success:function(a,b,c){var g=f.HandleError(a,b,c);return g?(f.resetAuthentication(),void e(g)):(f.bIsConnected=!0,f.oAuthentication.AccessToken=a.AccessToken,f.dtTokenExpires=a.TokenExpires,void d())},error:function(a,b,c){f.resetAuthentication(),f.HandleProtocolError(c,b,a,e)}}))},b.prototype.LoginWithToken=function(b,c,d,e,f){var g=this;this.IsConnected()||(this.resetAuthentication(),this.oAuthentication={Username:b,ClientSecret:d,AccessToken:c},$.ajax({url:this.sServerURL+a.Constants.AccessAPIURLs.CheckToken,data:this.oAuthentication,method:"post",timeout:6e4,cache:!1,success:function(a,b,c){var d=g.HandleError(a,b,c);return d?(g.resetAuthentication(),void f(d)):(g.bIsConnected=!0,g.dtTokenExpires=a.TokenExpires,void e())},error:function(a,b,c){g.resetAuthentication(),g.HandleProtocolError(c,b,a,f)}}))},b.prototype.resetAuthentication=function(){this.bIsConnected=!1,this.oAuthentication=null,this.dtTokenExpires=null},b.prototype.HandleError=function(b,c,d){if(b!==!1&&!b)return{HttpErrorCode:400,Error:"No response received from server.",ErrorDetails:"",ClientErrorCode:a.Constants.ErrorCodes.EmptyResponse,ClientErrorConstant:a.Constants.ErrorCodes[a.Constants.ErrorCodes.EmptyResponse]};if(b.error){var e=b.error;return e.ClientErrorCode=a.Constants.ErrorCodes.ServerRejected,e.ClientErrorConstant=a.Constants.ErrorCodes[a.Constants.ErrorCodes.ServerRejected],e}return null},b.prototype.HandleProtocolError=function(b,c,d,e){d||e({HttpErrorCode:-1,Error:"Unknown error",ErrorDetails:"",ClientErrorCode:a.Constants.ErrorCodes.UnknownError,ClientErrorConstant:a.Constants.ErrorCodes[a.Constants.ErrorCodes.UnknownError]});var f=-1,g="Unknown error";d.status>0&&(f=d.status),d.statusText&&(g=d.statusText);var h="";if(d.responseJSON&&(d.responseJSON.Message&&(h=d.responseJSON.Message),d.responseJSON.ModelState))for(var i in d.responseJSON.ModelState)if(d.responseJSON.ModelState.hasOwnProperty(i)){var j=d.responseJSON.ModelState[i];h+=" "+j.join(" ")}e({HttpErrorCode:f,Error:g,ErrorDetails:h,ClientErrorCode:f>0?a.Constants.ErrorCodes.HttpError:a.Constants.ErrorCodes.UnknownError,ClientErrorConstant:f>0?a.Constants.ErrorCodes[a.Constants.ErrorCodes.HttpError]:a.Constants.ErrorCodes[a.Constants.ErrorCodes.UnknownError]})},b.prototype.generateClientSecret=function(){return this.generateRandomString(64)},b.prototype.generateRandomString=function(a){for(var b="",c='<>|^*~!#?-_.,:;Â¤%&/()={[]}\\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',d=0;a>d;d++)b+=c.charAt(Math.floor(Math.random()*b.length));return b},b}();a.JSClient=b}(b=a.SDK||(a.SDK={}))}(MeetingMole||(MeetingMole={}));var MeetingMole;!function(a){var b;!function(a){var b=function(){function b(a){this.oClient=null,this.oClient=a}return b.prototype.GetAll=function(b,c){var d=this;$.ajax({url:this.oClient.ServerURL()+a.Constants.TeamsAPIURLs.GetAll,data:{Authentication:this.oClient.Authentication()},method:"post",timeout:3e4,cache:!1,success:function(a,e,f){var g=d.oClient.HandleError(a,e,f);return g?void c(g):void b(a.Teams)},error:function(a,b,e){d.oClient.HandleProtocolError(e,b,a,c)}})},b.prototype.Get=function(b,c,d){var e=this;$.ajax({url:this.oClient.ServerURL()+a.Constants.TeamsAPIURLs.Get,data:{Authentication:this.oClient.Authentication()},method:"post",timeout:3e4,cache:!1,success:function(a,b,f){var g=e.oClient.HandleError(a,b,f);return g?void d(g):void c(a)},error:function(a,b,c){e.oClient.HandleProtocolError(c,b,a,d)}})},b}();a.TeamController=b}(b=a.SDK||(a.SDK={}))}(MeetingMole||(MeetingMole={}));var MeetingMole;!function(a){var b;!function(a){var b=function(){function b(a){this.oClient=null,this.oClient=a}return b.prototype.Capture=function(b){var c=this;if(!b.API_KEY)throw"meetingmole.js: API_KEY must be defined for the Capture Widget.";if(!b.TeamID||b.TeamID<1)throw"meetingmole.js: TeamID must be defined for the Capture Widget.";if(!b.WidgetID||""===b.WidgetID.trim())throw"meetingmole.js: WidgetID must be defined for the Capture Widget.";if(!b.ButtonID||""===b.ButtonID.trim())throw"meetingmole.js: ButtonID must be defined for the Capture Widget.";var d=$("#"+b.ButtonID);if(d.length<1)throw"meetingmole.js: ButtonID must be of a clickable element present on the page.";var e=null;if(b.EmailFieldID&&""!==b.EmailFieldID.trim()){if(e=$("#"+b.EmailFieldID),e.length<1||"input"!==e.get(0).tagName.toLowerCase())throw"meetingmole.js: EmailFieldID must be of an input element present on the page."}else if(!b.OnSubmit)throw"meetingmole.js: OnSubmit event must be defined and return a valid email address when EmailFieldID is not defined.";d.off("click.capturewidget").on("click.capturewidget",function(){var d;return e?(d=e.val(),b.OnSubmit&&b.OnSubmit()):d=b.OnSubmit(),c.validateEmail(d)?void c.captureWidgetSubmit(d,b,function(){b.OnSuccess&&b.OnSuccess(),b.OnComplete&&b.OnComplete(!0)},function(a){b.OnError&&b.OnError(a),b.OnComplete&&b.OnComplete(!1)}):(b.OnError&&b.OnError({HttpErrorCode:-1,Error:"Please define a valid email address.",ErrorDetails:"",ClientErrorCode:a.Constants.ErrorCodes.WidgetError_EmailAddressInvalid,ClientErrorConstant:a.Constants.ErrorCodes[a.Constants.ErrorCodes.WidgetError_EmailAddressInvalid]}),void(b.OnComplete&&b.OnComplete(!1)))})},b.prototype.captureWidgetSubmit=function(b,c,d,e){var f=this;$.ajax({url:this.oClient.ServerURL()+a.Constants.WidgetsAPIURLs.CaptureSubmit,data:{API_KEY:c.API_KEY,WidgetID:c.WidgetID,TeamID:c.TeamID,Params:{Email:b}},method:"post",timeout:6e4,cache:!1,success:function(b,c,g){var h=f.oClient.HandleError(b,c,g);return h||!b?(h||(h={ClientErrorCode:a.Constants.ErrorCodes.ServerRejected,ClientErrorConstant:a.Constants.ErrorCodes[a.Constants.ErrorCodes.ServerRejected],Error:"Server returned failure without reason.",HttpErrorCode:-1,ErrorDetails:""}),void e(h)):void d()},error:function(a,b,c){f.oClient.HandleProtocolError(c,b,a,e)}})},b.prototype.validateEmail=function(a){var b=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)},b}();a.WidgetController=b}(b=a.SDK||(a.SDK={}))}(MeetingMole||(MeetingMole={}));var MeetingMole;!function(a){var b;!function(a){var b;!function(b){function c(){i=$("#btnPing"),j=$("#btnLogin"),k=$("#btnLogout"),h=$("#divResponseDisplay"),l=$("#txServerURL"),m=$("#btnClearLog"),n=$("#btnGetVersionInfo"),o=$("#btnGetTeams"),l.off("change").on("change",function(){p&&(p.Dispose(),p=null);var b=l.val().trim();p=b?new a.JSClient(b):null}),l.val("http://localhost:56936").trigger("change"),m.off("click").on("click",function(){f()}),i.off("click").on("click",function(){return p?(g("Pinging "+p.ServerURL()+"..."),void p.Ping(function(a){g("Ping success! Took "+a+" ms.",q.Success)},function(a){g("Ping failed.",q.Error),g("Error: "+e(a))})):void g("Not connected to server. Please define server URL to connect to.",q.Error)}),n.off("click").on("click",function(){return p?(g("Version info for "+p.ServerURL()+":"),void p.GetVersionInfo(function(a){g(e(a))},function(a){g("Could not get version info."),g("Error: "+e(a),q.Error)})):void g("Not connected to server. Please define server URL to connect to.",q.Error)}),j.off("click").on("click",function(){return p?p.IsConnected()?void g("Already logged in.",q.Normal):(g("Logging in to "+p.ServerURL()+"..."),void p.Login($("#txLogin").val(),$("#txPassword").val(),function(){g("Login success!",q.Success)},function(a){g("Login failed."),g("Error: "+e(a),q.Error)})):void g("Not connected to server. Please define server URL to connect to.",q.Error)}),k.off("click").on("click",function(){return p?p.IsConnected()?(g("Logging out from "+p.ServerURL()+"..."),void p.Logout(function(){g("You have been logged out.",q.Success)},function(a){g("Logout failed."),g("Error: "+e(a),q.Error)})):void g("Not logged in. Please log in first.",q.Error):void g("Not connected to server. Please define server URL to connect to.",q.Error)}),o.off("click").on("click",function(){return p?p.IsConnected()?(g("Getting teams for "+p.Username()+" from "+p.ServerURL()+"..."),void p.Teams.GetAll(function(a){g("Teams got."),g(e(a))},function(a){g("Error: "+e(a),q.Error)})):void g("Not logged in. Please log in first.",q.Error):void g("Not connected to server. Please define server URL to connect to.",q.Error)}),$("#btnCapture").off("click").on("click",function(a){return a.stopPropagation(),a.preventDefault(),d(),!1})}function d(){var a=$("#txCaptureWidgetAPIKey").val(),b=$("#txCaptureWidgetID").val(),c=$("#txCaptureWidgetTeamID").val(),d=parseInt(c,10)||-1;if(!a||!b||1>d)return void g("To test the widget, please define API KEY, Widget ID and Team ID first.",q.Error);var f={EmailFieldID:"txCaptureWidgetEmail",ButtonID:"btnCapture",TeamID:d,WidgetID:b,API_KEY:a,OnSubmit:function(){return g("Capturing..."),null},OnError:function(a){g("ERROR:",q.Error),g(e(a))},OnSuccess:function(){g("Captured!",q.Success)},OnComplete:function(){$("#btnCapture").off("click.capturewidget")}};p.Widgets.Capture(f),$("#btnCapture").trigger("click.capturewidget")}function e(a){return"string"!=typeof a&&(a=JSON.stringify(a,void 0,2)),a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"<pre>"+a.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(a){var b="number";return/^"/.test(a)?b=/:$/.test(a)?"key":"string":/true|false/.test(a)?b="boolean":/null/.test(a)&&(b="null"),'<span class="'+b+'">'+a+"</span>"})+"</pre>"}function f(){h.empty()}function g(a,b){if(void 0===b&&(b=q.Normal),a){var c=q[b].toLowerCase();h.append("<div class='log-"+c+"'>"+a+"</div>")}}var h=null,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=null;b.Init=c;var q;!function(a){a[a.Normal=0]="Normal",a[a.Error=1]="Error",a[a.Success=2]="Success",a[a.Indent=3]="Indent"}(q||(q={}))}(b=a.JSClientTest||(a.JSClientTest={}))}(b=a.SDK||(a.SDK={}))}(MeetingMole||(MeetingMole={}));var MeetingMole;!function(a){var b;!function(a){var b;!function(a){a.BaseURL="/publicapi/v1/",a.AccessAPIURLs={SimpleLogin:"access/simplelogin",About:"access/about",CheckToken:"access/checktoken",Logout:"access/logout"},a.TeamsAPIURLs={Get:"teams/get",GetAll:"teams/getall"},a.WidgetsAPIURLs={CaptureSubmit:"widgets/capturesubmit"},function(a){a[a.UnknownError=0]="UnknownError",a[a.HttpError=1]="HttpError",a[a.EmptyResponse=2]="EmptyResponse",a[a.ServerRejected=3]="ServerRejected",a[a.WidgetError_EmailAddressInvalid=100]="WidgetError_EmailAddressInvalid"}(a.ErrorCodes||(a.ErrorCodes={}));a.ErrorCodes}(b=a.Constants||(a.Constants={}))}(b=a.SDK||(a.SDK={}))}(MeetingMole||(MeetingMole={}));
//# sourceMappingURL=meetingmole.js.map