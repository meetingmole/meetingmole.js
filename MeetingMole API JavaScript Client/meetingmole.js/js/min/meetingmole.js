/*
 * MeetingMole API JavaScript Client v1.0.2
 * Copyright 2015-2016 MeetingMole GmbH. All Rights Reserved.
 * More info, documentation and source: https://github.com/meetingmole/meetingmole.js
*/
"use strict";var MeetingMole;!function(a){var b;!function(a){var b=function(){function a(a){this.oClient=null,this.oClient=a}return a}();a.ItemService=b}(b=a.SDK||(a.SDK={}))}(MeetingMole||(MeetingMole={}));var MeetingMole;!function(a){var b;!function(b){var c=function(){function c(c){if(this.oAuthentication=null,this.dtTokenExpires=null,this.Items=null,this.Teams=null,this.sServerURL=null,this.bIsConnected=!1,!c)throw"Parameter sServerURL must be defined.";if(c=c.trim(),0!==c.indexOf("http://")&&0!==c.indexOf("https://"))throw"Parameter sServerURL must start with authority (http:// or https://).";"/"===c[c.length-1]&&(c=c.substring(0,c.length-1)),this.sServerURL=c+a.Constants.BaseURL,this.Items=new b.ItemService(this),this.Teams=new b.TeamService(this)}return c.prototype.Authentication=function(){return this.oAuthentication},c.prototype.ClientVersion=function(){return"1.0.2"},c.prototype.ServerURL=function(){return this.sServerURL},c.prototype.Username=function(){return this.bIsConnected&&this.oAuthentication?this.oAuthentication.Username:null},c.prototype.IsConnected=function(){return this.bIsConnected},c.prototype.Dispose=function(){var a=this;this.IsConnected()&&this.Logout(function(){},function(){a.resetAuthentication()}),this.sServerURL=null},c.prototype.Ping=function(a,b){var c=new Date;this.GetVersionInfo(function(){var b=new Date,d=b.valueOf()-c.valueOf();a(d)},b)},c.prototype.GetVersionInfo=function(b,c){var d=this;$.ajax({url:this.sServerURL+a.Constants.AccessAPIURLs.About,method:"get",timeout:3e4,cache:!1,success:function(a,e,f){var g=d.HandleError(a,e,f);if(g)return void c(g);var h={ClientVersion:d.ClientVersion(),APIVersion:a.Version,WebAppVersion:a.WebAppVersion,CoreVersion:a.CoreVersion};b(h)},error:function(a,b,e){d.HandleProtocolError(e,b,a,c)}})},c.prototype.CheckToken=function(b,c){var d=this;this.IsConnected()&&$.ajax({url:this.sServerURL+a.Constants.AccessAPIURLs.CheckToken,data:{Authentication:this.oAuthentication},method:"post",timeout:3e4,cache:!1,success:function(a,e,f){var g=d.HandleError(a,e,f);return g?void c(g):(d.dtTokenExpires=a.TokenExpires,void b())},error:function(a,b,e){d.HandleProtocolError(e,b,a,c)}})},c.prototype.Logout=function(b,c){var d=this;this.IsConnected()&&$.ajax({url:this.sServerURL+a.Constants.AccessAPIURLs.Logout,data:{Authentication:this.oAuthentication,InvalidateAllTokens:!1},method:"post",timeout:3e4,cache:!1,success:function(a,e,f){var g=d.HandleError(a,e,f);return g?void c(g):(d.resetAuthentication(),void b(a))},error:function(a,b,e){d.HandleProtocolError(e,b,a,c)}})},c.prototype.Login=function(b,c,d,e){var f=this;this.IsConnected()||(this.resetAuthentication(),this.oAuthentication={Username:b,ClientSecret:this.generateClientSecret(),AccessToken:null},$.ajax({url:this.sServerURL+a.Constants.AccessAPIURLs.SimpleLogin,data:{Username:this.oAuthentication.Username,Password:c,ClientSecret:this.oAuthentication.ClientSecret},method:"post",timeout:6e4,cache:!1,success:function(a,b,c){var g=f.HandleError(a,b,c);return g?(f.resetAuthentication(),void e(g)):(f.bIsConnected=!0,f.oAuthentication.AccessToken=a.AccessToken,f.dtTokenExpires=a.TokenExpires,void d())},error:function(a,b,c){f.resetAuthentication(),f.HandleProtocolError(c,b,a,e)}}))},c.prototype.LoginWithToken=function(b,c,d,e,f){var g=this;this.IsConnected()||(this.resetAuthentication(),this.oAuthentication={Username:b,ClientSecret:d,AccessToken:c},$.ajax({url:this.sServerURL+a.Constants.AccessAPIURLs.CheckToken,data:this.oAuthentication,method:"post",timeout:6e4,cache:!1,success:function(a,b,c){var d=g.HandleError(a,b,c);return d?(g.resetAuthentication(),void f(d)):(g.bIsConnected=!0,g.dtTokenExpires=a.TokenExpires,void e())},error:function(a,b,c){g.resetAuthentication(),g.HandleProtocolError(c,b,a,f)}}))},c.prototype.resetAuthentication=function(){this.bIsConnected=!1,this.oAuthentication=null,this.dtTokenExpires=null},c.prototype.HandleError=function(a,b,c){return a?a.error?a.error:null:{HttpErrorCode:400,Error:"No response received from server.",ErrorDetails:""}},c.prototype.HandleProtocolError=function(a,b,c,d){c||d({HttpErrorCode:-1,Error:"Unknown error",ErrorDetails:""});var e=-1,f="Unknown error";c.status>0&&(e=c.status),c.statusText&&(f=c.statusText);var g="";if(c.responseJSON&&(c.responseJSON.Message&&(g=c.responseJSON.Message),c.responseJSON.ModelState))for(var h in c.responseJSON.ModelState)if(c.responseJSON.ModelState.hasOwnProperty(h)){var i=c.responseJSON.ModelState[h];g+=" "+i.join(" ")}d({HttpErrorCode:e,Error:f,ErrorDetails:g})},c.prototype.generateClientSecret=function(){return this.generateRandomString(64)},c.prototype.generateRandomString=function(a){for(var b="",c='<>|^*~!#?-_.,:;Â¤%&/()={[]}\\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',d=0;a>d;d++)b+=c.charAt(Math.floor(Math.random()*b.length));return b},c}();b.JSClient=c}(b=a.SDK||(a.SDK={}))}(MeetingMole||(MeetingMole={}));var MeetingMole;!function(a){var b;!function(b){var c=function(){function b(a){this.oClient=null,this.oClient=a}return b.prototype.GetAll=function(b,c){var d=this;$.ajax({url:this.oClient.ServerURL()+a.Constants.TeamAPIURLs.GetAll,data:{Authentication:this.oClient.Authentication()},method:"post",timeout:3e4,cache:!1,success:function(a,e,f){var g=d.oClient.HandleError(a,e,f);return g?void c(g):void b(a.Teams)},error:function(a,b,e){d.oClient.HandleProtocolError(e,b,a,c)}})},b}();b.TeamService=c}(b=a.SDK||(a.SDK={}))}(MeetingMole||(MeetingMole={}));var MeetingMole;!function(a){var b;!function(a){var b;!function(b){function c(){h=$("#btnPing"),i=$("#btnLogin"),j=$("#btnLogout"),g=$("#divResponseDisplay"),k=$("#txServerURL"),l=$("#btnClearLog"),m=$("#btnGetVersionInfo"),n=$("#btnGetTeams"),k.off("change").on("change",function(){o&&(o.Dispose(),o=null);var b=k.val().trim();o=b?new a.JSClient(b):null}),k.val("http://localhost:56936").trigger("change"),l.off("click").on("click",function(){e()}),h.off("click").on("click",function(){return o?(f("Pinging "+o.ServerURL()+"..."),void o.Ping(function(a){f("Ping success! Took "+a+" ms.",p.Success)},function(a){f("Ping failed.",p.Error),f("Error: "+d(a))})):void f("Not connected to server. Please define server URL to connect to.",p.Error)}),m.off("click").on("click",function(){return o?(f("Version info for "+o.ServerURL()+":"),void o.GetVersionInfo(function(a){f(d(a))},function(a){f("Could not get version info."),f("Error: "+d(a),p.Error)})):void f("Not connected to server. Please define server URL to connect to.",p.Error)}),i.off("click").on("click",function(){return o?o.IsConnected()?void f("Already logged in.",p.Normal):(f("Logging in to "+o.ServerURL()+"..."),void o.Login($("#txLogin").val(),$("#txPassword").val(),function(){f("Login success!",p.Success)},function(a){f("Login failed."),f("Error: "+d(a),p.Error)})):void f("Not connected to server. Please define server URL to connect to.",p.Error)}),j.off("click").on("click",function(){return o?o.IsConnected()?(f("Logging out from "+o.ServerURL()+"..."),void o.Logout(function(){f("You have been logged out.",p.Success)},function(a){f("Logout failed."),f("Error: "+d(a),p.Error)})):void f("Not logged in. Please log in first.",p.Error):void f("Not connected to server. Please define server URL to connect to.",p.Error)}),n.off("click").on("click",function(){return o?o.IsConnected()?(f("Getting teams for "+o.Username()+" from "+o.ServerURL()+"..."),void o.Teams.GetAll(function(a){f("Teams got."),f(d(a))},function(a){f("Error: "+d(a),p.Error)})):void f("Not logged in. Please log in first.",p.Error):void f("Not connected to server. Please define server URL to connect to.",p.Error)})}function d(a){return"string"!=typeof a&&(a=JSON.stringify(a,void 0,2)),a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"<pre>"+a.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(a){var b="number";return/^"/.test(a)?b=/:$/.test(a)?"key":"string":/true|false/.test(a)?b="boolean":/null/.test(a)&&(b="null"),'<span class="'+b+'">'+a+"</span>"})+"</pre>"}function e(){g.empty()}function f(a,b){if(void 0===b&&(b=p.Normal),a){var c=p[b].toLowerCase();g.append("<div class='log-"+c+"'>"+a+"</div>")}}var g=null,h=null,i=null,j=null,k=null,l=null,m=null,n=null,o=null;b.Init=c;var p;!function(a){a[a.Normal=0]="Normal",a[a.Error=1]="Error",a[a.Success=2]="Success",a[a.Indent=3]="Indent"}(p||(p={}))}(b=a.JSClientTest||(a.JSClientTest={}))}(b=a.SDK||(a.SDK={}))}(MeetingMole||(MeetingMole={}));var MeetingMole;!function(a){var b;!function(a){a.BaseURL="/publicapi/v1/",a.AccessAPIURLs={SimpleLogin:"access/simplelogin",About:"access/about",CheckToken:"access/checktoken",Logout:"access/logout"},a.TeamAPIURLs={GetAll:"team/getall"}}(b=a.Constants||(a.Constants={}))}(MeetingMole||(MeetingMole={}));
//# sourceMappingURL=meetingmole.js.map